<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Positive Drug Tests – Cleveland Dot Plot</title>
  <link rel="stylesheet" href="css/styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    .chart-container {
      max-width: 1000px;
      margin: 3rem auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 6px 10px;
      border-radius: 5px;
      font-size: 13px;
      pointer-events: none;
      z-index: 1000;
    }
    svg {
      width: 100%;
      height: 700px;
    }
    .legend {
      font-size: 13px;
    }
  </style>
</head>
<body>

   <header>
    <div class="header-inner">
      <div class="logo">
        <img src="images/logo.png" alt="Australian Government"/>
      </div>
      <h1>Police Enforcement</h1>
    </div>
    <nav>
      <ul>
        <li><a href="index.html" data-target="home" class="active">Home</a></li>
        <li><a href="#" data-target="random-breath-tests">Random breath tests</a></li>
        <li><a href="drugtests.html" data-target="drug-tests">Drugs on the Road</a></li>
        <li><a href="mobile-phone.html" data-target="mobile-phone">Mobile phone</a></li>
        <li><a href="#" data-target="speeding">Speeding</a></li>
        <li><a href="seatbelts.html" data-target="seatbelts">Non-wearing seatbelts</a></li>
        <li><a href="unlicensed_driving.html" data-target="unlicensed-driving">Unlicensed driving</a></li>
      </ul>
    </nav>
  </header>

  <main>
   
    <section class="tab-content active">
       <h2>Fines from Positive Drug Tests on the Road</h2>
      <p>Here you can explore trends in fines issued to drugged drivers across Australia, including camera-detected offences.</p>
      <div class="chart-container">
  <h3 style="text-align: center; margin-bottom: 1rem;">Drug Offences by Jurisdiction from 2008 to 2023</h3>
  <div id="dotplot"></div>
</div>

    </section>
  </main>


   <footer>
    <p>© 2025 Australian Government Department of Infrastructure, Transport, Regional Development, Communications and the Arts</p>
  </footer>

  <script>
    const margin = {top: 20, right: 40, bottom: 50, left: 150},
          width = 1000 - margin.left - margin.right,
          height = 650 - margin.top - margin.bottom;

    const svg = d3.select("#dotplot")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    const color = d3.scaleOrdinal(d3.schemeTableau10);

    d3.csv("database/drug_police_enforcement_2023_positive_drug_tests_2024-09-20.csv").then(data => {
      data = data.filter(d => d.METRIC === "positive_drug_tests" && d.JURISDICTION && d.YEAR && d.COUNT);
      data.forEach(d => {
        d.YEAR = +d.YEAR;
        d.COUNT = +d.COUNT;
      });

      // Grouped by jurisdiction
      const jurisdictions = Array.from(new Set(data.map(d => d.JURISDICTION))).sort();
      const years = Array.from(new Set(data.map(d => d.YEAR))).sort();

      const x = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.COUNT)]).nice()
        .range([0, width]);

      const y = d3.scaleBand()
        .domain(jurisdictions)
        .range([0, height])
        .padding(0.6);

      // Draw axes
      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(6));

      svg.append("g")
        .call(d3.axisLeft(y));

      // Draw connecting lines
      jurisdictions.forEach(jurisdiction => {
        const row = data.filter(d => d.JURISDICTION === jurisdiction);

        svg.append("path")
          .datum(row)
          .attr("fill", "none")
          .attr("stroke", "#ccc")
          .attr("stroke-width", 1)
          .attr("d", d3.line()
            .x(d => x(d.COUNT))
            .y(d => y(d.JURISDICTION) + y.bandwidth() / 2)
          );
      });

      // Draw dots
      svg.selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", d => x(d.COUNT))
          .attr("cy", d => y(d.JURISDICTION) + y.bandwidth() / 2)
          .attr("r", 5)
          .attr("fill", d => color(d.YEAR))
          .on("mouseover", (event, d) => {
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip.html(
              `<strong>${d.JURISDICTION}</strong><br/>
              Year: ${d.YEAR}<br/>
              Positive Tests: ${d.COUNT}`
            )
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 30) + "px");
          })
          .on("mouseout", () => {
            tooltip.transition().duration(400).style("opacity", 0);
          });

      // Draw legend
      const legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", `translate(${width - 120}, 0)`);

      years.forEach((year, i) => {
        const g = legend.append("g").attr("transform", `translate(0, ${i * 20})`);
        g.append("rect").attr("width", 10).attr("height", 10).attr("fill", color(year));
        g.append("text").attr("x", 15).attr("y", 10).text(year).attr("alignment-baseline", "middle");
      });
    });
  </script>
</body>
</html>
